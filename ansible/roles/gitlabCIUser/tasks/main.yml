---
# tasks file for gitlabCIUser
- name: Create gitlabci User
  become: true
  user:
    name: gitlabci

- name: Set gitlabci Users authorized key
  become: true
  authorized_key:
    user: gitlabci
    key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdPcSxvXYhVrt+IGU7zVWiR2H75CuKnGD8/W5B+fb2Th4uYuNKfWlZEj9naRK1jw0W7SYYk4DS7rzDGnuQzLqmwrOqnq/c32Azbg3YdikLckKFJsOBvbbklPJnTU+qW6CNEG1nyZjoMkrGqSXJeomcK6lynCHAMwpWCWKJL7eJkvydRtKhlX0pGtxcAlkZlsOWf09nrGZeRVcoYETyuouOqeillhDHEPTb9NqZPbT/b8XDLK+Fy0CmzuIP8hrdkgoBBBRqv2EZFkP80mHMidnru/22WDU0jZSRNeSe7ZX6mUB1Xnn5VVkdiFMqKXUl1rkDOyKxw7MuHxx0+TRmkkwp bernardbussy@FVFVXUF5J1WK-MacAir.local
    state: present

- name: set allowed commands for gitlabci user
  become: true
  blockinfile:
    path: /etc/sudoers
    block: |
      gitlabci  ALL=(brain)  NOPASSWD: ALL
      gitlabci  ALL = NOPASSWD: /bin/mv /home/gitlabci/brain /home/brain
      gitlabci  ALL = NOPASSWD: /bin/systemctl stop brain.service
      gitlabci  ALL = NOPASSWD: /bin/systemctl start brain.service
      gitlabci  ALL = NOPASSWD: /bin/tar -xvf  portal.tar
      gitlabci  ALL = NOPASSWD: /bin/rm -rf /var/www/*
      gitlabci  ALL = NOPASSWD: /bin/cp -r build/* /var/www/
      gitlabci  ALL = NOPASSWD: /bin/rm -rf /home/gitlabci/*
      gitlabci  ALL = NOPASSWD: /bin/mv /home/gitlabci/nerve /home/nerve
      gitlabci  ALL = NOPASSWD: /bin/systemctl stop nerve.service
      gitlabci  ALL = NOPASSWD: /bin/systemctl start nerve.service
